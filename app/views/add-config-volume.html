<div class="add-to-project middle surface-shaded">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-10">
        <breadcrumbs breadcrumbs="breadcrumbs"></breadcrumbs>
        <div ng-if="!error && (!targetObject || !configMaps || !secrets)">加载中...</div>

        <div ng-if="error" class="empty-state-message text-center">
          <h2>该 {{kind | humanizeKind}} 无法加载</h2>
          <p>{{error | getErrorDetails}}</p>
        </div>

        <div ng-if="targetObject && configMaps && secrets">
          <div ng-if="!configMaps.length && !secrets.length && !(configMapVersion | canI : 'create') && !(secretVersion | canI : 'create')" class="empty-state-message empty-state-full-page text-center">
            <h2>没有配置映射或私密。</h2>

            <p>
              {{project | displayName}} 项目中没有配置映射或私密可以使用这种{{kind | humanizeKind}}的卷。
            </p>

            <p ng-if="targetObject"><a ng-href="{{targetObject | navigateResourceURL}}">Back to {{kind | humanizeKind}} {{name}}</a></p>
          </div>

          <div ng-if="configMaps.length || secrets.length || (configMapVersion | canI : 'create') || (secretVersion | canI : 'create')" class="mar-top-xl">
            <h1>将配置文件添加到 {{name}}</h1>
            <div class="help-block">
              从配置映射或私密中添加值作为卷。这将使数据作为{{kind | humanizeKind}} {{name}}的文件可用。
            </div>
            <form name="forms.addConfigVolumeForm" class="mar-top-lg">
              <fieldset ng-disabled="disableInputs">
                <div class="form-group">
                  <label class="required">来源</label>
                  <ui-select ng-model="attach.source" ng-required="true">
                    <ui-select-match placeholder="Select config map or secret">
                      <span>
                        {{$select.selected.metadata.name}}
                        <small class="text-muted">&ndash; {{$select.selected.kind | humanizeKind : true}}</small>
                      </span>
                    </ui-select-match>
                    <ui-select-choices
                        repeat="source in (configMaps.concat(secrets)) | filter : { metadata: { name: $select.search } } track by (source | uid)"
                        group-by="groupByKind">
                      <span ng-bind-html="source.metadata.name | highlight : $select.search"></span>
                    </ui-select-choices>
                  </ui-select>
                  <div ng-if="(configMapVersion | canI : 'create') || (secretVersion | canI : 'create')" class="mar-top-md">
                    <span ng-if="configMapVersion | canI : 'create'">
                      <a ng-href="project/{{project.metadata.name}}/create-config-map">创建配置映射</a>
                    </span>
                    <span ng-if="secretVersion | canI : 'create'">
                      <span ng-if="configMapVersion | canI : 'create'" class="action-divider" aria-hidden="true">|</span>
                      <a ng-href="project/{{project.metadata.name}}/create-secret">创建私密</a>
                    </span>
                  </div>
                  <div class="help-block">
                    选择配置源。它的数据将作为卷装载在容器中。
                  </div>
                </div>

                <div class="form-group">
                  <label for="mount-path" class="required">挂载路径</label>
                  <input
                      id="mount-path"
                      class="form-control"
                      type="text"
                      name="mountPath"
                      ng-model="attach.mountPath"
                      required
                      ng-pattern="/^\/.*$/"
                      osc-unique="existingMountPaths"
                      placeholder="example: /data"
                      autocorrect="off"
                      autocapitalize="none"
                      spellcheck="false"
                      aria-describedby="mount-path-help">
                  <div>
                    <span id="mount-path-help" class="help-block">
                      卷的挂载路径。
                      <span ng-if="!attach.pickKeys">
                        将在此目录中为配置映射或私密中的每个键创建一个文件。文件内容将是键的值。
                      </span>
                    </span>
                  </div>
                  <div class="has-error" ng-show="forms.addConfigVolumeForm.mountPath.$error.pattern && forms.addConfigVolumeForm.mountPath.$touched">
                    <span class="help-block">
                      挂载路径必须是从根目录开始的有效路径 <code>/</code>.
                    </span>
                  </div>
                  <div class="has-error" ng-show="forms.addConfigVolumeForm.mountPath.$error.oscUnique">
                    <span class="help-block">
                        挂载路径已被使用。请选择另一条挂载路径。
                    </span>
                  </div>
                </div>

                <div class="form-group">
                  <div class="checkbox">
                    <label>
                      <input
                          id="select-keys"
                          type="checkbox"
                          ng-model="attach.pickKeys"
                          ng-disabled="!attach.source"
                          aria-describedby="select-keys-help">
                        选择特定的键和路径
                    </label>
                    <div id="select-keys-help" class="help-block">
                        只添加某些键或使用与键名不同的路径。
                    </div>
                  </div>
                </div>

                <div ng-if="attach.pickKeys && attach.source" class="mar-bottom-md">
                  <h3>键和路径</h3>
                  <div class="help-block mar-bottom-md">
                    选择要使用的键和每个键将公开的文件路径。
                    文件路径相对于挂载路径。
                    每个文件的内容将是键的值。
                  </div>
                  <div ng-repeat="item in attach.items">
                    <div class="row">
                      <div class="form-group col-md-6">
                        <label class="required">Key</label>
                        <ui-select ng-model="item.key" ng-required="true">
                          <ui-select-match placeholder="Pick a key">
                            {{$select.selected}}
                          </ui-select-match>
                          <ui-select-choices repeat="key in attach.source.data | keys | filter : $select.search">
                            <span ng-bind-html="key | highlight : $select.search"></span>
                          </ui-select-choices>
                        </ui-select>
                      </div>
                      <div class="form-group col-md-6">
                        <label ng-attr-for="path-{{$id}}" class="required">路径</label>
                        <input
                            ng-attr-id="path-{{$id}}"
                            class="form-control"
                            ng-class="{ 'has-error': forms.addConfigVolumeForm['path-' + $id].$invalid && forms.addConfigVolumeForm['path-' + $id].$touched }"
                            type="text"
                            name="path-{{$id}}"
                            ng-model="item.path"
                            ng-pattern="RELATIVE_PATH_PATTERN"
                            required
                            osc-unique="itemPaths"
                            placeholder="example: config/app.properties"
                            autocorrect="off"
                            autocapitalize="none"
                            spellcheck="false">
                        <div class="has-error" ng-show="forms.addConfigVolumeForm['path-' + $id].$error.pattern">
                          <span class="help-block">
                            路径必须是相对路径。 路径不能以 <code>/</code> 开头，或者包含 <code>..</code> 路径元素。
                          </span>
                        </div>
                        <div class="has-error" ng-show="forms.addConfigVolumeForm['path-' + $id].$error.oscUnique">
                          <span class="help-block">
                            路径必须是唯一的。
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="mar-bottom-md">
                      <a ng-hide="attach.items.length === 1" href="" ng-click="removeItem($index)">Remove Item</a>
                      <span ng-if="$last">
                        <span ng-hide="attach.items.length === 1" class="action-divider" aria-hidden="true">|</span>
                        <a href="" ng-click="addItem()">添加项</a>
                      </span>
                    </div>
                  </div>
                </div>

                <div ng-if="targetObject.spec.template.spec.containers.length > 1">
                  <h3 ng-class="{ hidden: attach.allContainers && !attach.pickKeys }">容器</h3>
                  <div ng-if="attach.allContainers">
                    卷将装入所有容器。你可以
                    <a href="" ng-click="attach.allContainers = false">选择特定的容器</a>
                    代替。
                  </div>

                  <div ng-if="!attach.allContainers" class="form-group">
                    <label class="sr-only required">容器</label>
                    <select-containers
                        ng-model="attach.containers"
                        pod-template="targetObject.spec.template"
                        ng-required="true"
                        help-text="将卷添加到所选容器。">
                    </select-containers>
                  </div>
                </div>

                <div class="button-group gutter-top gutter-bottom">
                  <button type="submit"
                      class="btn btn-primary btn-lg"
                      ng-click="addVolume()"
                      ng-disabled="forms.addConfigVolumeForm.$invalid || disableInputs">添加</button>
                  <a class="btn btn-default btn-lg"
                      role="button"
                      href=""
                      ng-click="cancel()">取消</a>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
      </div><!-- /col-md-* -->
    </div><!-- /row -->
  </div><!-- /container -->
</div><!-- /middle -->
