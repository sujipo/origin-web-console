<div class="middle">
  <div class="middle-header">
    <div class="container-fluid">
      <breadcrumbs breadcrumbs="breadcrumbs"></breadcrumbs>
      <alerts alerts="alerts"></alerts>
      <div>
        <h1 class="contains-actions">
          <div class="pull-right dropdown" ng-if="deployment" ng-hide="!('deployments' | canIDoAny)">
            <button type="button" class="dropdown-toggle btn btn-default actions-dropdown-btn hidden-xs" data-toggle="dropdown">
              动作
              <span class="caret" aria-hidden="true"></span>
            </button>
            <a href=""
               class="dropdown-toggle actions-dropdown-kebab visible-xs-inline"
               data-toggle="dropdown"><i class="fa fa-ellipsis-v"></i><span class="sr-only">动作</span></a>
            <ul class="dropdown-menu dropdown-menu-right actions action-button">
              <li ng-if="!deployment.spec.paused && !updatingPausedState && (deploymentsVersion | canI : 'update')">
                <a href="" ng-click="setPaused(true)" role="button">暂停部署</a>
              </li>
              <li ng-if="deployment.spec.paused && !updatingPausedState && (deploymentsVersion | canI : 'update')">
                <a href="" ng-click="setPaused(false)" role="button">继续部署</a>
              </li>
              <li class="divider" ng-if="!updatingPausedState && (deploymentsVersion | canI : 'update')"></li>
              <li ng-if="deploymentsVersion | canI : 'update'">
                <a ng-href="project/{{project.metadata.name}}/attach-pvc?kind=Deployment&name={{deployment.metadata.name}}&group=apps"
                   role="button">添加存储</a>
              </li>
              <li ng-if="!autoscalers.length && (horizontalPodAutoscalersVersion | canI : 'create')">
                <!-- Create a new HPA. -->
                <a ng-href="project/{{projectName}}/edit/autoscaler?kind=Deployment&name={{deployment.metadata.name}}&group=apps"
                   role="button">添加自动伸缩控制</a>
              </li>
              <li ng-if="autoscalers.length === 1 && (horizontalPodAutoscalersVersion | canI : 'update')">
                <!-- Edit an existing HPA. -->
                <a ng-href="project/{{projectName}}/edit/autoscaler?kind=HorizontalPodAutoscaler&group=autoscaling&name={{autoscalers[0].metadata.name}}"
                  role="button">编辑自动伸缩控制</a>
              </li>
              <li ng-if="deploymentsVersion | canI : 'update'">
                <a ng-href="project/{{projectName}}/set-limits?kind=Deployment&name={{deployment.metadata.name}}&group=apps"
                  role="button">编辑资源限制</a>
              </li>
              <li ng-if="deploymentsVersion | canI : 'update'">
                <a ng-href="{{healthCheckURL}}" role="button">编辑健康检查</a>
              </li>
              <li ng-if="deploymentsVersion | canI : 'update'">
                <a ng-href="{{deployment | editYamlURL}}" role="button">编辑YAML</a>
              </li>
              <li class="divider" ng-if="deploymentsVersion | canI : 'update'"></li>
              <li ng-if="deploymentsVersion | canI : 'delete'">
                <delete-link
                  kind="Deployment"
                  group="apps"
                  resource-name="{{deployment.metadata.name}}"
                  project-name="{{deployment.metadata.namespace}}"
                  alerts="alerts"
                  hpa-list="autoscalers">
                </delete-link>
              </li>
            </ul>
          </div>
          {{name}}
          <small class="meta" ng-if="deployment">created <span am-time-ago="deployment.metadata.creationTimestamp"></span></small>
        </h1>
        <labels labels="deployment.metadata.labels" clickable="true" kind="deployments" project-name="{{deployment.metadata.namespace}}" limit="3"></labels>
      </div>
    </div>
  </div><!-- /middle-header-->
  <div class="middle-content" persist-tab-state>
    <div class="container-fluid">
      <div ng-if="!loaded">加载中...</div>
      <div class="row" ng-if="loaded">
        <div class="col-md-12" ng-class="{ 'hide-tabs' : !deployment }">
          <div ng-if="deployment.spec.paused && !updatingPausedState" class="alert alert-info animate-if">
            <span class="pficon pficon-info" aria-hidden="true"></span>
            <strong>{{deployment.metadata.name}} 已经暂停。</strong>
            这将暂停任何正在进行的部署，并在部署恢复之前停止新部署的运行。
            <span ng-if="!updatingPausedState && (deploymentsVersion | canI : 'update')" class="nowrap">
              <a href="" ng-click="setPaused(false)" role="button">继续部署</a>
            </span>
          </div>
          <uib-tabset>
            <uib-tab active="selectedTab.history">
              <uib-tab-heading>历史</uib-tab-heading>
              <div class="table-filter-extension">
                <div class="data-toolbar">
                  <div class="data-toolbar-filter">
                    <project-filter></project-filter>
                  </div>
                </div>
              </div>
              <table class="table table-bordered table-mobile table-layout-fixed">
                <colgroup>
                  <col class="col-sm-2">
                  <col class="col-sm-4">
                  <col class="col-sm-3">
                  <col class="col-sm-3">
                </colgroup>
                <thead>
                  <tr>
                    <th>版本</th>
                    <th>名称</th>
                    <th>副本</th>
                    <th>创建</th>
                  </tr>
                </thead>
                <tbody ng-if="(replicaSetsForDeployment | size) == 0">
                  <tr><td colspan="4"><em>{{emptyMessage}}</em></td></tr>
                </tbody>
                <tbody ng-if="(replicaSetsForDeployment | size) > 0">
                  <tr ng-repeat="replicaSet in replicaSetsForDeployment">
                    <td data-title="Version">
                      #{{replicaSet | annotation : 'deployment.kubernetes.io/revision'}}
                    </td>
                    <td data-title="Name">
                      <a ng-href="{{replicaSet | navigateResourceURL}}">{{replicaSet.metadata.name}}</a>
                    </td>
                    <td data-title="Replicas">
                      <span ng-if="replicaSet.status.replicas !== replicaSet.spec.replicas">{{replicaSet.status.replicas}}/</span>{{replicaSet.spec.replicas}} replica<span ng-if="replicaSet.spec.replicas != 1">s</span>
                    </td>
                    <td data-title="Created">
                      <span am-time-ago="replicaSet.metadata.creationTimestamp"></span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </uib-tab>
            <uib-tab active="selectedTab.configuration">
              <uib-tab-heading>配置</uib-tab-heading>
              <div class="resource-details" ng-if="deployment">
                <div class="row">
                  <div class="col-lg-6">
                    <!--
                      Show a header at lg and xl screen sizes to balance the columns, but hide
                      it at smaller widths since "Details" is not very meaningful.
                    -->
                    <h3 class="hidden visible-lg visible-xl">详情</h3>
                    <dl class="dl-horizontal left">
                      <dt>选择器:</dt>
                      <dd>
                        <selector selector="deployment.spec.selector"></selector>
                      </dd>
                      <dt>副本:</dt>
                      <dd>
                        <replicas spec="deployment.spec.replicas"
                                  disable-scaling="inProgressDeployment || autoscalers.length"
                                  scale-fn="scale(replicas)"
                                  deployment="deployment"></replicas>
                        <span ng-if="autoscalers.length">(autoscaled)</span>
                        <div ng-if="deployment.status.updatedReplicas">
                          {{deployment.status.updatedReplicas}} up to date
                        </div>
                        <div ng-if="deployment.status.availableReplicas || deployment.status.unavailableReplicas">
                          <span ng-if="deployment.status.availableReplicas">{{deployment.status.availableReplicas}} available<span ng-if="deployment.status.unavailableReplicas">,</span></span>
                          <span ng-if="deployment.status.unavailableReplicas">{{deployment.status.unavailableReplicas}} unavailable</span>
                        </div>
                      </dd>
                      <dt>策略:</dt>
                      <dd>{{deployment.spec.strategy.type | sentenceCase}}</dd>
                      <dt ng-if-start="deployment.spec.strategy.rollingUpdate">
                        最大不可用:
                        <span data-toggle="tooltip"
                          title="更新过程中不可用的pod的最大数量。"
                          class="pficon pficon-help text-muted small"></span>
                      </dt>
                      <dd>
                        <span ng-if="deployment.spec.strategy.rollingUpdate.maxUnavailable | isNil">25%</span>
                        <span ng-if="!(deployment.spec.strategy.rollingUpdate.maxUnavailable | isNil)">
                          {{deployment.spec.strategy.rollingUpdate.maxUnavailable}}
                        </span>
                      </dd>
                      <dt>
                        最大增量值:
                        <span data-toggle="tooltip"
                          title="可以创建的超过所需的pod数量的最大pod数量。"
                          class="pficon pficon-help text-muted small"></span>
                      </dt>
                      <dd ng-if-end>
                        <span ng-if="deployment.spec.strategy.rollingUpdate.maxSurge | isNil">25%</span>
                        <span ng-if="!(deployment.spec.strategy.rollingUpdate.maxSurge | isNil)">
                          {{deployment.spec.strategy.rollingUpdate.maxSurge}}
                        </span>
                      </dd>
                      <dt>
                        最小就绪值:
                        <span data-toggle="tooltip"
                          title="一个新的pod在被认为可用之前必须准备好它的最小秒数。"
                          class="pficon pficon-help text-muted small"></span>
                      </dt>
                      <dd>
                        {{deployment.spec.minReadySeconds || 0}} sec
                      </dd>
                      <dt>
                        修订历史限制:
                        <span data-toggle="tooltip"
                          title="需要保存的旧副本集的数量。"
                          class="pficon pficon-help text-muted small"></span>
                      </dt>
                      <dd>
                        {{deployment.spec.revisionHistoryLimit || 2}}
                      </dd>
                      <dt>
                        等待超时期限:
                        <span data-toggle="tooltip"
                          title="等待部署取得进展而认为失败的时间量。"
                          class="pficon pficon-help text-muted small"></span>
                      </dt>
                      <dd>
                        {{deployment.spec.progressDeadlineSeconds || 600}} sec
                      </dd>
                    </dl>

                    <h3>模板</h3>
                    <pod-template
                        pod-template="deployment.spec.template"
                        images-by-docker-reference="imagesByDockerReference"
                        builds="builds"
                        detailed="true"
                        add-health-check-url="{{ (deploymentsVersion | canI : 'update') ? healthCheckURL : '' }}">
                    </pod-template>

                  </div>
                  <div class="col-lg-6">
                    <h3>卷</h3>
                    <p ng-if="!deployment.spec.template.spec.volumes.length && !(deploymentsVersion | canI : 'update')">
                      none
                    </p>
                    <volumes
                        volumes="deployment.spec.template.spec.volumes"
                        namespace="project.metadata.name"
                        can-remove="deploymentsVersion | canI : 'update'"
                        remove-fn="removeVolume(volume)">
                    </volumes>
                    <div ng-if="deploymentsVersion | canI : 'update'">
                      <a ng-href="project/{{project.metadata.name}}/attach-pvc?kind=Deployment&name={{deployment.metadata.name}}&group=apps">添加存储</a>
                      <span class="action-divider" aria-hidden="true">|</span>
                      <a ng-href="project/{{project.metadata.name}}/add-config-volume?kind=Deployment&name={{deployment.metadata.name}}&group=apps">添加配置文件</a>
                    </div>

                    <h3>自动伸缩</h3>

                    <!-- Show any warnings. -->
                    <div ng-repeat="warning in hpaWarnings" class="alert alert-warning">
                      <span class="pficon pficon-warning-triangle-o" aria-hidden="true"></span>
                      <span class="sr-only">警告:</span>
                      {{warning.message}}

                      <!-- If the CPU request is missing, add an action to set one. -->
                      <a ng-href="project/{{projectName}}/set-limits?kind=Deployment&name={{deployment.metadata.name}}&group=apps"
                         ng-if="warning.reason === 'NoCPURequest' && (deploymentsVersion | canI : 'update')"
                         role="button">编辑资源
                        <span ng-if="!('cpu' | isRequestCalculated : project)">要求和</span>限制</a>
                    </div>

                    <!-- Create autoscaler -->
                    <div ng-if="!autoscalers.length">
                      <a ng-if="horizontalPodAutoscalersVersion | canI : 'create'" ng-href="project/{{projectName}}/edit/autoscaler?kind=Deployment&name={{deployment.metadata.name}}&group=apps"
                         role="button">添加自动伸缩控制</a>
                      <span ng-if="!(horizontalPodAutoscalersVersion | canI : 'create')">none</span>
                    </div>

                    <!-- HPA details -->
                    <div ng-repeat="hpa in autoscalers">
                      <hpa hpa="hpa" project="project" show-scale-target="false" alerts="alerts"></hpa>
                    </div>

                  </div>
                  <!-- Service Bindings -->
                  <div class="col-lg-6">
                    <resource-service-bindings
                      project="project"
                      project-context="projectContext"
                      api-object="deployment">
                    </resource-service-bindings>
                  </div>
                </div>
                <div class="mar-top-md">
                  <annotations annotations="deployment.metadata.annotations"></annotations>
                </div>
              </div>
            </uib-tab>
            <uib-tab heading="Environment" active="selectedTab.environment" ng-if="deployment">
              <uib-tab-heading>环境</uib-tab-heading>
              <edit-environment-variables api-object="deployment"></edit-environment-variables>
            </uib-tab>
            <uib-tab active="selectedTab.events" ng-if="eventsVersion | canI : 'watch'">
              <uib-tab-heading>事件</uib-tab-heading>
              <events api-objects="[ deployment ]" project-context="projectContext" ng-if="selectedTab.events"></events>
            </uib-tab>
          </uib-tabset>
        </div><!-- /col-* -->
      </div>
    </div>
  </div><!-- /middle-content -->
</div>
