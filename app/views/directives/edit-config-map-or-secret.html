<ng-form name="keyValueMapForm">
  <fieldset>
    <!-- Name -->
    <div ng-show="showNameInput" class="form-group">
      <label for="key-value-map-name" class="required">名称</label>
      <!-- regex, maxlength from k8s.io/kubernetes/pkg/util/validation/validation.go -->
      <div ng-class="{ 'has-error': keyValueMapForm.name.$invalid && keyValueMapForm.name.$touched }">
        <input
            id="key-value-map-name"
            class="form-control"
            type="text"
            name="name"
            ng-model="map.metadata.name"
            ng-required="showNameInput"
            ng-pattern="nameValidation.pattern"
            ng-maxlength="nameValidation.maxlength"
            placeholder="my-{{type}}"
            select-on-focus
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            aria-describedby="key-value-map-name-help">
      </div>
      <div>
        <span id="key-value-map-name-help" class="help-block">项目中{{type}}的唯一名称。</span>
      </div>
      <div class="has-error" ng-show="keyValueMapForm.name.$error.pattern && keyValueMapForm.name.$touched">
        <span class="help-block">
          {{nameValidation.description}}
        </span>
      </div>
      <div class="has-error" ng-show="keyValueMapForm.name.$error.required && keyValueMapForm.name.$touched">
        <span class="help-block">
          名字是必需的。
        </span>
      </div>
      <div class="has-error" ng-show="keyValueMapForm.name.$error.maxlength">
        <span class="help-block">
          不能超过 {{nameValidation.maxlength}} 字符。
        </span>
      </div>
    </div>

    <div ng-if="!data.length">
      <p><em>{{type}}没有项。</em></p>
      <a href="" ng-click="addItem()">添加项</a>
    </div>

    <div ng-repeat="item in data" ng-init="keys = getKeys()">
      <div class="form-group">
        <label ng-attr-for="key-{{$id}}" class="required">键</label>
        <!--
          Config map validation:
          https://github.com/openshift/origin/blob/32708e768d77db08b118d084955a7ccf2aebbf1c/vendor/k8s.io/client-go/1.4/pkg/util/validation/validation.go#L271-L273
        -->
        <div ng-class="{ 'has-error': keyValueMapForm['key-' + $id].$invalid && keyValueMapForm['key-' + $id].$touched }">
          <input
              class="form-control"
              name="key-{{$id}}"
              ng-attr-id="key-{{$id}}"
              type="text"
              ng-model="item.key"
              required
              ng-pattern="/^[-._a-zA-Z0-9]+$/"
              ng-maxlength="253"
              osc-unique="keys"
              placeholder="my.key"
              select-on-focus
              autocorrect="off"
              autocapitalize="none"
              spellcheck="false"
              aria-describedby="key-{{$id}}-help">
        </div>
        <div class="help-block">
          这个{{type}}条目的唯一键。
        </div>
        <div class="has-error" ng-show="keyValueMapForm['key-' + $id].$error.required && keyValueMapForm['key-' + $id].$touched">
          <span class="help-block">
            键是必需的。
          </span>
        </div>
        <div class="has-error" ng-show="keyValueMapForm['key-' + $id].$error.oscUnique && keyValueMapForm['key-' + $id].$touched && item.key">
          <span class="help-block">
            重复键“{{item.key}}”。 键在{{type}}中必须是唯一的。
          </span>
        </div>
        <div class="has-error" ng-show="keyValueMapForm['key-' + $id].$error.pattern && keyValueMapForm['key-' + $id].$touched">
          <span class="help-block">
            键可能只由字母、数字、句号、连字符和下划线组成。
          </span>
        </div>
        <div class="has-error" ng-show="keyValueMapForm['key-' + $id].$error.maxlength">
          <span class="help-block">
            键值不能超过253个字符。
          </span>
        </div>
      </div>
      <div class="form-group" ng-attr-id="drop-zone-{{$id}}">
        <label ng-attr-for="name-{{$id}}">值</label>
        <div ng-if="isBinaryFile" class="h4">
          该文件包含二进制内容。
        </div>
        <osc-file-input
          model="item.value"
          drop-zone-id="drop-zone-{{$id}}"
          help-text="为{{type}}条目输入值或使用文件的内容。"
          read-as-binary-string="readAsBinaryString"
          is-binary-file="isBinaryFile"></osc-file-input>
        <div ui-ace="{
          theme: 'eclipse',
          rendererOptions: {
            showPrintMargin: false
          }
        }" ng-model="item.value" ng-if="!isBinaryFile" class="ace-bordered ace-inline-small mar-top-sm" ng-attr-id="value-{{$id}}"></div>
      </div>
      <div class="mar-bottom-md">
        <a href="" ng-click="removeItem($index)">删除项</a>
        <span ng-if="$last">
          <span class="action-divider">|</span>
          <a href="" ng-click="addItem()">添加项</a>
        </span>
      </div>
    </div>
    <div>
    </div>
  </fieldset>
</ng-form>
