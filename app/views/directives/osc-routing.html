<ng-form name="routeForm">
  <fieldset ng-disabled="routingDisabled">

    <!-- Name -->
    <div ng-show="showNameInput" class="form-group">
      <label for="route-name" class="required">名称</label>
      <span ng-class="{ 'has-error': routeForm.name.$invalid && routeForm.name.$touched && !routingDisabled }">
        <input
            id="route-name"
            class="form-control"
            type="text"
            name="name"
            ng-model="route.name"
            ng-required="showNameInput"
            ng-pattern="nameValidation.pattern"
            ng-maxlength="nameValidation.maxlength"
            placeholder="my-route"
            select-on-focus
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            aria-describedby="route-name-help">
      </span>
      <div>
        <span id="route-name-help" class="help-block">在项目中路由名称必须唯一。</span>
      </div>
      <div class="has-error" ng-show="routeForm.name.$error.pattern && routeForm.name.$touched && !routingDisabled">
        <span class="help-block">
          {{nameValidation.description}}
        </span>
      </div>
      <div class="has-error" ng-show="routeForm.name.$error.maxlength && routeForm.name.$touched && !routingDisabled">
        <span class="help-block">
          Can't be longer than {{nameValidation.maxlength}} characters.
        </span>
      </div>
    </div>

    <!-- Host -->
    <div class="form-group">
      <label for="host">主机名</label>
      <span ng-class="{ 'has-error': routeForm.host.$invalid && routeForm.host.$touched && !routingDisabled }">
        <input
            id="host"
            class="form-control"
            type="text"
            name="host"
            ng-model="route.host"
            ng-pattern="hostnamePattern"
            ng-maxlength="hostnameMaxLength"
            ng-readonly="isHostnameReadOnly()"
            placeholder="www.example.com"
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            aria-describedby="route-host-help">
      </span>
      <div>
        <span id="route-host-help" class="help-block">
          <p>
            路线的公共主机名。
            <span ng-if="!hostReadOnly">
              如果没有指定，将自行生成一个主机名。
            </span>
            <span ng-if="!disableWildcards">
              您可以用 <var>*.example.com</var> 形式来支持通配符子域的路由器。
            </span>
          </p>
          <p ng-if="(existingRoute || canICreateCustomHosts) && !canIUpdateCustomHosts">在创建路由后，主机名不能更改。</p>
        </span>
      </div>
      <div class="has-error" ng-show="routeForm.host.$error.pattern && routeForm.host.$touched && !routingDisabled">
        <span class="help-block">
          主机名必须由小写字母、数字、句点和连字符组成。
          它必须以字母或数字开头和结尾。
          <span ng-if="!disableWildcards">通配符子域可能以 <var>*.</var> 开头</span>
        </span>
      </div>
      <div class="has-error" ng-show="routeForm.host.$error.maxlength && routeForm.host.$touched && !routingDisabled">
        <span class="help-block">
            不能超过 {{hostnameMaxLength}} 个字符。
        </span>
      </div>
    </div>

    <!-- Path -->
    <div class="form-group">
      <label for="path">路径</label>
      <span ng-class="{ 'has-error': routeForm.path.$invalid && routeForm.path.$touched && !routingDisabled }">
        <input
            id="path"
            class="form-control"
            type="text"
            name="path"
            ng-model="route.path"
            ng-pattern="/^\/.*$/"
            ng-disabled="route.tls.termination === 'passthrough'"
            placeholder="/"
            autocorrect="off"
            autocapitalize="none"
            spellcheck="false"
            aria-describedby="route-path-help">
      </span>
      <div>
        <span id="route-path-help" class="help-block">
          路由器监视路由到服务的路径。
        </span>
      </div>
      <div class="has-error" ng-show="routeForm.path.$error.pattern && routeForm.path.$touched && !routingDisabled">
        <span class="help-block">
          路径必须以 <code>/</code> 开头
        </span>
      </div>
      <div class="has-warning" ng-show="route.path && route.tls.termination === 'passthrough'">
        <span class="help-block">
            路径值将不会被使用。 不能为贯通TLS设置路径。
        </span>
      </div>
    </div>

    <!-- Service -->
    <div ng-if="services">
      <osc-routing-service model="route.to"
                           service-options="services"
                           all-services="servicesByName"
                           show-weight="route.alternateServices.length > 1 || (controls.hideSlider && route.alternateServices.length)"
                           warn-unnamed-port="unnamedServicePort">
      </osc-routing-service>
    </div>

    <!-- Target Port -->
    <div ng-if="route.portOptions.length" class="form-group">
      <label for="routeTargetPort">目标端口</label>
      <ui-select ng-if="route.portOptions.length" ng-model="route.targetPort" input-id="routeTargetPort" search-enabled="false" aria-describedby="target-port-help">
        <ui-select-match>{{$select.selected.label}}</ui-select-match>
        <ui-select-choices repeat="portOption.port as portOption in route.portOptions">
          {{portOption.label}}
        </ui-select-choices>
      </ui-select>
      <div>
        <span id="target-port-help" class="help-block">
          目标端口为了通信
        </span>
      </div>
    </div>


    <!-- Alternate Services for A/B Traffic -->
    <div ng-if="alternateServiceOptions.length">
      <h3>Alternate Services</h3>
      <div class="form-group">
        <div class="checkbox">
          <label>
            <input type="checkbox" ng-model="options.alternateServices" aria-describedby="secure-route-help">
            多个服务将分割流量。
          </label>
          <div class="help-block">
            路由可以将流量直接发送到多个服务，以进行A/B测试。
            每个服务都有一个权重来控制它所获得的流量。
          </div>
        </div>
      </div>

      <div ng-repeat="alternate in route.alternateServices" class="form-group">
        <osc-routing-service
          model="alternate"
          service-options="alternateServiceOptions"
          all-services="servicesByName"
          is-alternate="true"
          show-weight="route.alternateServices.length > 1 || controls.hideSlider">
        </osc-routing-service>
        <div class="row form-group-actions">
          <div class="col-sm-6">
            <button type="button" class="btn btn-link" ng-click="route.alternateServices.splice($index, 1)">移除服务</button>
            <span ng-if="$last && route.alternateServices.length < alternateServiceOptions.length">
              <span class="action-divider">|</span>
              <button type="button" class="btn btn-link" ng-click="addAlternateService()">添加另一个服务</button>
            </span>
          </div>
          <div ng-if="route.alternateServices.length === 1 && controls.hideSlider" class="col-sm-6">
            <button type="button" class="btn btn-link" ng-click="controls.hideSlider = false">使用百分比滑块编辑权重</button>
          </div>
        </div>
      </div>
      <div ng-repeat="duplicate in duplicateServices" class="has-error mar-bottom-lg">
        <span class="help-block">
          服务 {{duplicate.metadata.name}} 不能重复添加.
        </span>
      </div>
    </div>

    <!-- If there is exactly one alternate service, let the user change the weights using a slider. -->
    <div ng-if="route.alternateServices.length === 1 && !controls.hideSlider">
      <h3>服务权重</h3>
      <div class="form-group">
        <div class="weight-slider-values">
          <div>
            <span class="service-name">{{route.to.name}}</span>
            <span class="weight-percentage">{{weightAsPercentage(route.to.weight, true)}}</span>
          </div>
          <div>
            <span class="weight-percentage hidden-xs">{{weightAsPercentage(route.alternateServices[0].weight, true)}}</span>
            <span class="service-name">{{route.alternateServices[0].name}}</span>
            <span class="weight-percentage visible-xs-inline">{{weightAsPercentage(route.alternateServices[0].weight, true)}}</span>
          </div>
        </div>
        <label class="sr-only" for="weight-slider">服务 {{route.to.service.metadata.name}} 权重</label>
        <input
            id="weight-slider"
            type="range"
            min="0"
            max="100"
            step="1"
            list="ticks"
            ng-model="controls.rangeSlider"
            aria-describedby="weight-slider-help"
            class="mar-top-md">
        <datalist id="ticks">
          <option>0</option>
          <option>25</option>
          <option>50</option>
          <option>75</option>
          <option>100</option>
        </datalist>
        <div class="help-block" id="weight-slider-help">
          发送给每个服务的流量百分比。拖动滑块来调整值或者
          <button type="button" class="btn btn-link" ng-click="controls.hideSlider = true">直接修改权重值</button>.
        </div>
      </div>
    </div>

    <h3>安全</h3>
    <div class="checkbox">
      <label>
        <input type="checkbox" ng-model="options.secureRoute" aria-describedby="secure-route-help">
        安全路由
      </label>
      <div class="help-block" id="secure-route-help">
        可以使用多个TLS终端类型来保护路由，以获取服务证书。
      </div>
    </div>

    <div ng-show="options.secureRoute">
      <!-- TLS Termination -->
      <div class="form-group">
        <label for="tlsTermination">TLS 终端</label>
        <ui-select ng-model="route.tls.termination" input-id="tlsTermination" search-enabled="false">
          <ui-select-match>{{$select.selected | humanizeTLSTermination}}</ui-select-match>
          <ui-select-choices repeat="option in ['edge', 'passthrough', 'reencrypt']">
            {{option | humanizeTLSTermination}}
          </ui-select-choices>
        </ui-select>
        <div class="learn-more-block help-block">
          <a href="{{'route-types' | helpLink}}" target="_blank">了解更多&nbsp;<i class="fa fa-external-link" aria-hidden="true"></i></a>
        </div>
      </div>

      <!-- Insecure Edge Termination Policy -->
      <div class="form-group">
        <label for="insecureTraffic">不安全的通信</label>
        <!-- Since we can't give the ui-select field a name, create a hidden input for Angular form validation. -->
        <input type="hidden" name="insecureTraffic">
        <ui-select ng-model="route.tls.insecureEdgeTerminationPolicy"
            name="insecureTraffic"
            input-id="insecureTraffic"
            aria-describedby="route-insecure-policy-help"
            search-enabled="false">
          <ui-select-match>{{$select.selected.label}}</ui-select-match>
          <ui-select-choices
              repeat="option.value as option in insecureTrafficOptions"
              ui-disable-choice="route.tls.termination === 'passthrough' && option.value === 'Allow'">
            {{option.label}}
          </ui-select-choices>
        </ui-select>
        <div>
          <span id="route-insecure-policy-help" class="help-block">
            不安全方案的流量策略有HTTP。
          </span>
        </div>
        <div ng-if="routeForm.insecureTraffic.$error.passthrough" class="has-warning">
          <span class="help-block">
            贯穿路由不能使用不安全的交通政策-<var>允许</var>。
          </span>
        </div>
      </div>

      <!-- Key and Certificates -->
      <h3>证书</h3>
      <div class="help-block">
        TLS证书为了移动和重新加密终端. 
        如果没有指定，则使用路由器的默认证书。
      </div>
      <div ng-if="showCertificatesNotUsedWarning" class="has-warning">
        <span class="help-block">
          您设置的证书或密钥将不会被使用。
          <span ng-if="!route.tls.termination">
            该路由不安全
          </span>
          <span ng-if="route.tls.termination === 'passthrough'">
            自定义证书不能用于贯穿终端。
          </span>
        </span>
      </div>
      <fieldset class="mar-top-md">
        <div>
          <div class="form-group" id="certificate-file">
            <label>Certificate</label>
            <osc-file-input
              model="route.tls.certificate"
              drop-zone-id="certificate-file"
              show-text-area="true"
              help-text="PEM格式的证书。通过拖放、选择或粘贴剪贴板来上传文件。"
              ng-readonly="areCertificateInputsReadOnly()"
              ng-disabled="areCertificateInputsDisabled()">
            </osc-file-input>
          </div>
          <div class="form-group" id="private-key-file">
            <label>私Key</label>
            <osc-file-input
              model="route.tls.key"
              drop-zone-id="private-key-file"
              show-text-area="true"
              help-text="PEM格式的关键。通过拖放、选择或粘贴剪贴板来上传文件。"
              ng-readonly="areCertificateInputsReadOnly()"
              ng-disabled="areCertificateInputsDisabled()">
          </osc-file-input>
          </div>
          <div class="form-group" id="ca-certificate-file">
            <label>CA证书</label>
            <osc-file-input
              model="route.tls.caCertificate"
              drop-zone-id="ca-certificate-file"
              show-text-area="true"
              help-text="PEM格式CA证书链。通过拖放、选择或粘贴剪贴板来上传文件。"
              ng-readonly="areCertificateInputsReadOnly()"
              ng-disabled="areCertificateInputsDisabled()">
            </osc-file-input>
          </div>
          <div class="form-group" id="dest-ca-certificate-file">
            <label>目的CA证书</label>
            <osc-file-input
                model="route.tls.destinationCACertificate"
                show-text-area="true"
                drop-zone-id="dest-ca-certificate-file"
                help-text="PEM格式CA证书链验证端点证书的重新加密终端。通过拖放、选择或粘贴剪贴板来上传文件。"
                ng-readonly="areCertificateInputsReadOnly()"
                ng-disabled="isDestinationCACertInputDisabled()">
            </osc-file-input>
            <!-- Show a warning if the value won't be used, but only if we're
                 not already showing the generic certificate warning above. -->
            <div ng-if="route.tls.destinationCACertificate && route.tls.termination !== 'reencrypt' && !showCertificatesNotUsedWarning" class="has-warning">
              <span class="help-block">
                目的CA证书将从路由中删除。
                目的CA证书仅用于重新加密终端。
              </span>
            </div>
          </div>
        </div>
      </fieldset>
    </div>
  </fieldset>
</ng-form>
