<div class="middle">
  <div class="middle-header">
    <div class="container-fluid">
      <div class="page-header page-header-bleed-right page-header-bleed-left">
        <h1>
          流水线
          <span class="page-header-link">
            <a ng-href="{{'pipeline-builds' | helpLink}}" target="_blank">
              了解更多 <i class="fa fa-external-link" aria-hidden="true"></i>
            </a>
          </span>
        </h1>
      </div>
    </div>
  </div>
  <div class="middle-content pipelines-page">
    <div class="container-fluid">
      <alerts alerts="alerts"></alerts>
      <div class="row">
        <div class="col-md-12">
          <div ng-if="!(buildConfigs | hashSize)" class="mar-top-lg">
            <div ng-if="!buildConfigsLoaded">
              加载中...
            </div>
            <div ng-if="buildConfigsLoaded" class="empty-state-message text-center">
              <h2>没有流水线</h2>
              <div ng-if="project.metadata.name | canIAddToProject">
                <p>
                  没有流水线添加到项目 {{projectName}}.
                  <br>
                  了解更多关于
                  <a ng-href="{{ 'pipeline-builds' | helpLink}}" target="_blank">流水线构建</a>
                  和
                  <a ng-href="{{ 'pipeline-plugin' | helpLink}}" target="_blank">OpenShift 流水线插件</a>.
                </p>
                <p ng-if="(project.metadata.name | canIAddToProject) && createSampleURL">
                  <a ng-href="{{createSampleURL}}" class="btn btn-primary btn-lg">
                    创建简单流水线
                  </a>
                </p>
              </div>
              <div ng-if="!(project.metadata.name | canIAddToProject)">
                <ng-include src="'views/_request-access.html'"></ng-include>
              </div>
            </div>
          </div>
          <div ng-repeat="(buildConfigName, buildConfig) in buildConfigs"
               ng-if="!buildConfig || (buildConfig | isJenkinsPipelineStrategy)"
               class="animate-repeat">
            <div ng-if="buildConfig">
              <div class="pull-right">
                <button
                    class="btn btn-default"
                    ng-if="buildConfigsInstantiateVersion | canI : 'create'"
                    ng-click="startBuild(buildConfig)">
                  开始流水线
                </button>
              </div>
              <h2 class="mar-top-none">
                <a ng-href="{{buildConfig | navigateResourceURL}}">{{buildConfigName}}</a>
                <small>创建 <span am-time-ago="buildConfig.metadata.creationTimestamp"></span></small>
              </h2>
              <div ng-if="buildConfig.spec.source.git.uri">
                源码库信息:
                <span class="word-break" ng-if="buildConfigs[buildConfigName].spec.source.type == 'Git'" ><osc-git-link
                      uri="buildConfigs[buildConfigName].spec.source.git.uri"
                      ref="buildConfigs[buildConfigName].spec.source.git.ref"
                      context-dir="buildConfigs[buildConfigName].spec.source.contextDir">{{buildConfigs[buildConfigName].spec.source.git.uri}}</osc-git-link></span>
              </div>
            </div>
            <!-- Handle missing build configs -->
            <div ng-if="!buildConfig">
              <h2>{{buildConfigName}}</h2>
              <!-- Only show the alert once the build configs have loaded to avoid flicker if builds load first. -->
              <div ng-if="buildConfigsLoaded" class="alert alert-warning">
                <span class="pficon pficon-warning-triangle-o" aria-hidden="true"></span>
                <span class="sr-only">警告:</span>
                构建配置 <strong>{{buildConfigName}}</strong> 不存在.
              </div>
            </div>
            <div ng-if="buildsLoaded && !(interestingBuildsByConfig[buildConfigName] | hashSize)">
              <p class="mar-bottom-xxl">
                没有流水线配置运行 {{buildConfigName}}.
                <span ng-if="buildConfig.spec.strategy.jenkinsPipelineStrategy.jenkinsfile">
                  打开 <a ng-href="{{(buildConfig | navigateResourceURL) + '?tab=configuration'}}">Jenkinsfile</a> 来查看将运行哪些阶段。
                </span>
                <span ng-if="buildConfig.spec.strategy.jenkinsPipelineStrategy.jenkinsfilePath">
                  打开文件 <code>{{buildConfig.spec.strategy.jenkinsPipelineStrategy.jenkinsfilePath}}</code> 在
                  <a ng-if="buildConfig | jenkinsfileLink" ng-href="buildConfig | jenkinsfileLink">源码库</a>
                  <span ng-if="!(buildConfig | jenkinsfileLink)">源码库</span>
                  来查看将运行哪些阶段。
                </span>
              </p>
            </div>
            <div ng-if="interestingBuildsByConfig[buildConfigName] | hashSize">
              <div ng-if="!(statsByConfig[buildConfigName].avgDuration | isNil)" class="hidden-xs pull-right text-muted">
                平均运行时间:
                {{statsByConfig[buildConfigName].avgDuration | timeOnlyDuration}}
              </div>
              <h4>
                最近运行
                <small ng-if="!(statsByConfig[buildConfigName].avgDuration | isNil)" class="visible-xs-block mar-top-xs text-muted">
                  平均运行时间:
                  {{statsByConfig[buildConfigName].avgDuration | timeOnlyDuration}}
                </small>
              </h4>
              <div ng-repeat="build in (interestingBuildsByConfig[buildConfigName] | orderObjectsByDate : true) track by (build | uid)"
                   class="animate-repeat">
                <build-pipeline build="build"></build-pipeline>
              </div>
              <div ng-if="buildConfig" class="mar-top-sm mar-bottom-xl">
                <a ng-href="{{buildConfigs[buildConfigName] | navigateResourceURL}}">查看流水线运行</a>
                <span ng-if="buildConfigsVersion | canI : 'update'">
                  <span class="action-divider">|</span>
                  <a ng-href="{{buildConfig | editResourceURL}}" role="button">编辑流水线</a>
                </span>
              </div>
            </div>
          </div>
        </div><!-- /col-* -->
      </div>
    </div>
  </div><!-- /middle-content -->
</div>
