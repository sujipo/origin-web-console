<div class="middle">
  <div class="middle-content">
    <div class="container-fluid">
      <alerts alerts="alerts"></alerts>
          <h1>
            <span ng-if="clusterQuotas.length">集群 </span>配额
            <span class="page-header-link">
              <a ng-href="{{'quota' | helpLink}}" target="_blank">
                了解更多 <i class="fa fa-external-link" aria-hidden="true"></i>
              </a>
            </span>
          </h1>
          <div ng-if="!quotas.length && !clusterQuotas.length" class="mar-top-xl">
            <div class="help-block">{{quotaHelp}}</div>
            <p><em ng-if="!quotas && !clusterQuotas">加载中...</em><em ng-if="quotas || clusterQuotas">这个项目没有配置资源配额</em></p>
          </div>

          <div ng-repeat="quota in clusterQuotas | orderBy: 'metadata.name'" class="gutter-bottom">
            <h2 ng-if="clusterQuotas.length">{{quota.metadata.name}}</h2>
            <div ng-if="$first" class="help-block">限制跨项目的资源使用。</div>
            <dl ng-if="quota.spec.quota.scopes.length">
              <dt>范围:</dt>
              <dd>
                <div ng-repeat="scope in quota.spec.quota.scopes">
                  {{scope | startCase}}
                  <span class="text-muted small" ng-if="scope | scopeDetails">&mdash; {{scope | scopeDetails}}</span>
                </div>
              </dd>
            </dl>
            <div>
              <div class="quota-charts">
                <div ng-if="quota.status.total.hard.cpu" class="mar-lg">
                  <h3 class="text-center">CPU <small>要求</small></h3>
                  <quota-usage-chart height="240" used="namespaceUsageByClusterQuota[quota.metadata.name].used.cpu" total="quota.status.total.hard.cpu" cross-project-used="quota.status.total.used.cpu" type="cpu" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.total.hard.memory" class="mar-lg">
                  <h3 class="text-center">Memory <small>要求</small></h3>
                  <quota-usage-chart height="240" used="namespaceUsageByClusterQuota[quota.metadata.name].used.memory" cross-project-used="quota.status.total.used.memory" total="quota.status.total.hard.memory" type="memory" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.total.hard['requests.cpu']" class="mar-lg">
                  <h3 class="text-center">CPU <small>要求</small></h3>
                  <quota-usage-chart height="240" used="namespaceUsageByClusterQuota[quota.metadata.name].used['requests.cpu']" cross-project-used="quota.status.total.used['requests.cpu']" total="quota.status.total.hard['requests.cpu']" type="cpu" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.total.hard['requests.memory']" class="mar-lg">
                  <h3 class="text-center">Memory <small>要求</small></h3>
                  <quota-usage-chart height="240" used="namespaceUsageByClusterQuota[quota.metadata.name].used['requests.memory']" cross-project-used="quota.status.total.used['requests.memory']" total="quota.status.total.hard['requests.memory']" type="memory" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.total.hard['limits.cpu']" class="mar-lg">
                  <h3 class="text-center">CPU <small>限制</small></h3>
                  <quota-usage-chart height="240" used="namespaceUsageByClusterQuota[quota.metadata.name].used['limits.cpu']" cross-project-used="quota.status.total.used['limits.cpu']" total="quota.status.total.hard['limits.cpu']" type="cpu" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.total.hard['limits.memory']" class="mar-lg">
                  <h3 class="text-center">Memory <small>限制</small></h3>
                  <quota-usage-chart height="240" used="namespaceUsageByClusterQuota[quota.metadata.name].used['limits.memory']" cross-project-used="quota.status.total.used['limits.memory']" total="quota.status.total.hard['limits.memory']" type="memory" class="quota-chart"></quota-usage-chart>
                </div>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <th>资源类型</th>
                  <th>使用值 (本项目)</th>
                  <th>使用值 (所有项目)</th>
                  <th>最大值</th>
                </thead>
                <tbody>
                  <tr ng-if='!quota.status.total.used' class="danger">
                    <td colspan="4">
                      <span data-toggle="tooltip" title="Missing quota status" class="pficon pficon-error-circle-o" style="cursor: help;"></span>
                      此配额使用记录上未报告状态。任何受此配额记录限制的资源都不能被分配。
                    </td>
                  </tr>
                  <!-- Don't show quotas for type `resourcequotas`. They are frequently at limit,
                       which is not something to worry about, and only a cluster admin can create
                       those resources anyway. -->
                  <tr ng-repeat="resourceType in orderedTypesByClusterQuota[quota.metadata.name]"
                      ng-if="resourceType !== 'resourcequotas'"
                      ng-class="{
                        warning: isAtLimit(quota, resourceType),
                        disabled: (quota.status.total.hard[resourceType] || quota.spec.quota.hard[resourceType]) === '0'
                      }">
                    <td>
                      {{resourceType | humanizeQuotaResource : true}}
                      <span ng-if="isAtLimit(quota, resourceType)" data-toggle="tooltip" title="Quota limit reached." class="pficon pficon-warning-triangle-o warnings-popover"></span>
                      <span ng-if="(quota.status.total.hard[resourceType] || quota.spec.quota.hard[resourceType]) === '0'"
                            data-toggle="tooltip"
                            title="You are not allowed to create resources of this type."
                            class="pficon pficon-info warnings-popover"></span>
                    </td>
                    <td>
                      <span ng-if="!namespaceUsageByClusterQuota[quota.metadata.name].used">&mdash;</span>
                      <span ng-if="namespaceUsageByClusterQuota[quota.metadata.name].used">{{namespaceUsageByClusterQuota[quota.metadata.name].used[resourceType] | usageWithUnits : resourceType}}</span>
                    </td>
                    <td>
                      <span ng-if="!quota.status.total.used">&mdash;</span>
                      <span ng-if="quota.status.total.used">{{quota.status.total.used[resourceType] | usageWithUnits : resourceType}}</span>
                    </td>
                    <td>
                      <span ng-if="!quota.status.total.hard">{{quota.spec.quota.hard[resourceType]  | usageWithUnits : resourceType}}</span>
                      <span ng-if="quota.status.total.hard">{{quota.status.total.hard[resourceType]  | usageWithUnits : resourceType}}</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <h1 ng-if="clusterQuotas.length && quotas.length">项目配额</h1>
          <div ng-repeat="quota in quotas | orderBy: 'metadata.name'" class="gutter-bottom">
            <h2 ng-if="quotas.length">{{quota.metadata.name}}</h2>
            <div ng-if="$first" class="help-block mar-bottom-md">{{quotaHelp}}</div>
            <dl ng-if="quota.spec.scopes.length">
              <dt>范围:</dt>
              <dd>
                <div ng-repeat="scope in quota.spec.scopes">
                  {{scope | startCase}}
                  <span class="text-muted small" ng-if="scope | scopeDetails">&mdash; {{scope | scopeDetails}}</span>
                </div>
              </dd>
            </dl>
            <div>
              <div class="quota-charts">
                <div ng-if="quota.status.hard.cpu" class="mar-lg">
                  <h3 class="text-center">CPU <small>要求</small></h3>
                  <quota-usage-chart used="quota.status.used.cpu" total="quota.status.hard.cpu" type="cpu" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.hard.memory" class="mar-lg">
                  <h3 class="text-center">Memory <small>要求</small></h3>
                  <quota-usage-chart used="quota.status.used.memory" total="quota.status.hard.memory" type="memory" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.hard['requests.cpu']" class="mar-lg">
                  <h3 class="text-center">CPU <small>要求</small></h3>
                  <quota-usage-chart used="quota.status.used['requests.cpu']" total="quota.status.hard['requests.cpu']" type="cpu" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.hard['requests.memory']" class="mar-lg">
                  <h3 class="text-center">Memory <small>要求</small></h3>
                  <quota-usage-chart used="quota.status.used['requests.memory']" total="quota.status.hard['requests.memory']" type="memory" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.hard['limits.cpu']" class="mar-lg">
                  <h3 class="text-center">CPU <small>限制</small></h3>
                  <quota-usage-chart used="quota.status.used['limits.cpu']" total="quota.status.hard['limits.cpu']" type="cpu" class="quota-chart"></quota-usage-chart>
                </div>
                <div ng-if="quota.status.hard['limits.memory']" class="mar-lg">
                  <h3 class="text-center">Memory <small>限制</small></h3>
                  <quota-usage-chart used="quota.status.used['limits.memory']" total="quota.status.hard['limits.memory']" type="memory" class="quota-chart"></quota-usage-chart>
                </div>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <th>资源类型</th>
                  <th>使用</th>
                  <th>最大</th>
                </thead>
                <tbody>
                  <tr ng-if='!quota.status.used' class="danger">
                    <td colspan="3">
                      <span data-toggle="tooltip" title="Missing quota status" class="pficon pficon-error-circle-o" style="cursor: help;"></span>
                      此配额使用记录上未报告状态。任何受此配额记录限制的资源都不能被分配。
                    </td>
                  </tr>
                  <!-- Don't show quotas for type `resourcequotas`. They are frequently at limit,
                       which is not something to worry about, and only a cluster admin can create
                       those resources anyway. -->
                  <tr ng-repeat="resourceType in orderedTypesByQuota[quota.metadata.name]"
                      ng-if="resourceType !== 'resourcequotas'"
                      ng-class="{
                        warning: isAtLimit(quota, resourceType),
                        disabled: (quota.status.hard[resourceType] || quota.spec.hard[resourceType]) === '0'
                      }">
                    <td>
                      {{resourceType | humanizeQuotaResource : true}}
                      <span ng-if="isAtLimit(quota, resourceType)" data-toggle="tooltip" title="Quota limit reached." class="pficon pficon-warning-triangle-o warnings-popover"></span>
                      <span ng-if="(quota.status.hard[resourceType] || quota.spec.hard[resourceType]) === '0'"
                            data-toggle="tooltip"
                            title="You are not allowed to create resources of this type."
                            class="pficon pficon-info warnings-popover"></span>
                    </td>
                    <td>
                      <span ng-if="!quota.status.used">&mdash;</span>
                      <span ng-if="quota.status.used">{{quota.status.used[resourceType] | usageWithUnits : resourceType}}</span>
                    </td>
                    <td>
                      <span ng-if="!quota.status.hard">{{quota.spec.hard[resourceType]  | usageWithUnits : resourceType}}</span>
                      <span ng-if="quota.status.hard">{{quota.status.hard[resourceType]  | usageWithUnits : resourceType}}</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="limit-ranges-section">
            <h1>限制范围</h1>
            <div ng-if="!limitRanges.length">
              <div class="help-block">{{limitRangeHelp}}</div>
              <p><em>{{emptyMessageLimitRanges}}</em></p>
            </div>

            <div ng-repeat="limitRange in limitRanges">
              <h2 ng-if="limitRanges.length">{{limitRange.metadata.name}}</h2>
              <div ng-if="$first" class="help-block mar-bottom-md">{{limitRangeHelp}}</div>
              <div class="table-responsive">
                <table class="table table-bordered">
                  <thead>
                    <th>资源类型</th>
                    <th>
                      <span class="nowrap">
                        最小
                        <i class="small pficon pficon-help" data-toggle="tooltip" title="The minimum amount of this compute resource that can be requested."></i>
                      </span>
                    </th>
                    <th>
                      <span class="nowrap">
                        最大
                        <i class="small pficon pficon-help" data-toggle="tooltip" title="The maximum amount of this compute resource that can be requested.  The limit must also be below the maximum value."></i>
                      </span>
                    </th>
                    <th>
                      默认
                      <span class="nowrap">
                        要求
                        <i class="small pficon pficon-help" data-toggle="tooltip" title="A container will default to request this amount of a compute resource if no request is specified. The system will guarantee the requested amount of compute resource when scheduling a container for execution. If a quota is enabled for this compute resource, the quota usage is incremented by the requested value."></i>
                      </span>
                    </th>
                    <th>
                      默认
                      <span class="nowrap">
                        限制
                        <i class="small pficon pficon-help" data-toggle="tooltip" title="The default limit defines the maximum amount of compute resource the container may have access to during execution if no limit is specified. If no request is made for the compute resource on the container or via a Default Request value, the container will default to request the limit."></i>
                      </span>
                    </th>
                    <th>
                      最大 限制/要求
                      <span class="nowrap">
                        比例
                        <i class="small pficon pficon-help" data-toggle="tooltip" title="If specified, the compute resource must have a request and limit that are both non-zero, where limit divided by request is less than or equal to the specified amount; this represents the max burst for the compute resource during execution."></i>
                      </span>
                    </th>
                  </thead>
                  <tbody ng-repeat="limit in limitRange.spec.limits">
                    <tr ng-repeat="(type, typeLimits) in limitsByType[limitRange.metadata.name][limit.type]">
                      <td>{{limit.type}} {{type | computeResourceLabel : true}}</td>
                      <td>{{(typeLimits.min | usageWithUnits : type) || "&mdash;"}}</td>
                      <td>{{(typeLimits.max | usageWithUnits : type) || "&mdash;"}}</td>
                      <td>{{(typeLimits.defaultRequest | usageWithUnits : type) || "&mdash;"}}</td>
                      <td>{{(typeLimits["default"] | usageWithUnits : type) || "&mdash;"}}</td>
                      <td>{{typeLimits.maxLimitRequestRatio || "&mdash;"}}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
    </div>
  </div><!-- /middle-content -->
</div>
